<!-- Copyright (c) 2025 Dario Rosina. Licenza MIT. Vedi file LICENSE. -->
<!DOCTYPE html>
<html lang="it">

<head>

    <title>JS | Lavorare con il DOM</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/prism.css" rel="stylesheet" />
    <style>
        body {
            margin: 10px;
            padding: 10px;
        }

        .modal-body {
            font-family: sans-serif;
            font-size: 14px;
            color: #fff;
        }

        .modal-body pre {
            height: 300px;
            overflow-y: auto;
        }

        .modal-body pre.show-code {
            opacity: 1;
        }

        .holdLog {
            font-family: monospace;
            position: absolute;
            z-index: 2;
            font-weight: 400;
            color: #393939;
        }

        .risultato {
            display: none;
            background-color: #6c757d;
            border-color: #6c757d;
            border-radius: 4px;
            color: white;
            padding: 0 4px;
        }

        .table tbody tr td:first-child {
            color: yellow;
        }
        #titolo1,#titolo2,#calcolo,#metodi,#listaImg {
            color: black;
            display: none;
        }
        #titolo1::before {
            content: "ðŸ’¬ ";
        }
        #titolo2::before {
            content: "ðŸ‘‹ ";
        }
        .titolo2{
            font-size: 1rem;
        }
        #calcolo::before {
            content: "ðŸ”¢ ";
            font-family: monospace;
        }
        #metodi::before {
            content: "ðŸ§° ";
            font-family: monospace;
        }
        #listaImg::before {
            content: "ðŸ–¼ ";
            font-family: monospace;
        }
        .function-list {
            list-style-type: none; /* Rimuove i pallini */
            padding: 0;
            margin: 1em 0;
            font-family: Consolas, monospace; /* Aspetto da codice */
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 8px;
            max-width: 300px;
        }
        .function-list li {
            padding: 8px 12px;
            border-bottom: 1px solid #ddd;
            color: #333;
        }
        .function-list li:last-child {
            border-bottom: none;
        }
        .function-list li:hover {
            background-color: #e0f7fa;
            cursor: pointer;
        }
        .img-container img{
            border: 4px solid silver;
            border-radius: 10px;
            padding: 5px;
            margin: 5px;
        }
    </style>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/prism.js"></script>
    <script>
        let propsCur // Manteniamo per il toggle, anche se potremmo usare currentModalProps
        let contaEs = 1
        let currentModalProps = null;

        function _setupFormatElement(containerId) {
            const element = document.getElementById(containerId);
            if (!element) {
                console.error(`Elemento con ID "${containerId}" non trovato per la formattazione.`);
                return null;
            }
            element.classList.add('holdLog');
            return element;
        }

        function setTit(containerId, tit) {
            document.getElementById('titoloEs').innerHTML = tit
        }

        function loadModal(props) {
            propsCur = props // Salva le props correnti per il toggle
            setTit("codice", props.title)

            const codeElement = document.getElementById('codice');
            const codeBlockContainer = codeElement ? codeElement.parentElement : null;
            if (codeElement && codeBlockContainer) {
                codeBlockContainer.classList.remove('show-code');
                codeElement.textContent = props.codeString.trim();
                Prism.highlightElement(codeElement, true, function(){
                    setTimeout(() => {
                        if (codeBlockContainer){
                            codeBlockContainer.classList.add('show-code');
                        }
                    }, 10);
                }); // Evidenzia la sintassi
            }

            // Pulisci i risultati precedenti e nascondili
            const risultato1El = document.getElementById('risultato1');
            risultato1El.style.display = 'none';
            risultato1El.innerHTML = '';

            try {
                // Crea una funzione per eseguire il codice in modo isolato
                const executeCode = new Function(props.codeString + ';');
                const results = executeCode();

            } catch (error) {
                console.error(`Errore durante l'esecuzione del codice per "${props.title}":`, error);
                // Mostra un messaggio di errore all'utente
                risultato1El.innerHTML = `Errore nell'esecuzione: ${error.message}`;
                risultato1El.style.display = '';
            }
        }

        function toggleElementDisplay(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                if (element.style.display === 'none' || element.style.display === '') {
                    element.style.display = 'block';
                } else {
                    element.style.display = 'none';
                }
            }
        }

        function nascondiElemento(elementId) {
            const elemento = document.getElementById(elementId);
            if (elemento) {
                elemento.style.display = 'none';
            }
        }

        function initHndlBtn(numEs) {
            const modalElement = document.getElementById('exampleModal');
            const toggleButton = document.getElementById('toggleRisultato');

            if (!modalElement) {
                console.error("Elemento modale #exampleModal non trovato.");
                return;
            }

            if (toggleButton) {
                toggleButton.addEventListener("click", () => {
                    // Il toggle funziona su propsCur, che viene impostato in loadModal
                    if (propsCur) {
                        toggleElementDisplay(propsCur.containerRisultato);
                    }
                });

                modalElement.addEventListener('show.bs.modal', function (event) {
                    // event.relatedTarget Ã¨ il bottone che ha attivato la modale
                    const button = event.relatedTarget;
                    if (button && button.id.startsWith('btnEs')) {
                        const esIndex = parseInt(button.id.replace('btnEs', ''), 10);
                        if (opzEs[esIndex]) {
                            currentModalProps = opzEs[esIndex];
                            loadModal(currentModalProps);
                        } else {
                            console.error(`Configurazione opzEs[${esIndex}] non trovata.`);
                            // Opzionalmente, impedisci l'apertura della modale o mostra un errore
                            // event.preventDefault(); // Se vuoi impedire l'apertura
                        }
                    } else if (currentModalProps) {
                        // Fallback se la modale viene aperta in altro modo e currentModalProps Ã¨ giÃ  impostato
                        loadModal(currentModalProps);
                    }
                });

                modalElement.addEventListener('hidden.bs.modal', function (event) {
                    document.getElementById('titoloEs').innerHTML = '';
                    const codeElement = document.getElementById('codice');
                    if (codeElement) {
                        codeElement.textContent = ''; // Pulisci il contenuto
                        const codeBlockContainer = codeElement.parentElement;
                        if (codeBlockContainer) {
                            codeBlockContainer.classList.remove('show-code'); // Rimuovi la classe per la prossima volta
                        }
                    }
                    propsCur = null;
                    currentModalProps = null;
                    const risultato1El = document.getElementById('risultato1');
                    nascondiElemento('risultato1');
                    nascondiElemento('titolo1');
                    nascondiElemento('titolo2');
                    nascondiElemento('calcolo');
                    nascondiElemento('metodi');
                    nascondiElemento('listaImg');
                });

                // Ciclo per aggiungere event listener ai bottoni "demo"
                // Assicurati che numEs corrisponda all'indice massimo in opzEs
                for (let i = 1; i <= numEs; i++) {
                    const button = document.getElementById(`btnEs${i}`);
                    if (button) {
                        button.addEventListener("click", () => {
                            if (opzEs[i]) {
                                currentModalProps = opzEs[i];
                            } else {
                                console.error(`Configurazione opzEs[${i}] non trovata.`);
                            }
                        });
                    } else {
                        console.warn(`Bottone btnEs${i} non trovato.`);
                    }
                }
            } else {
                console.error("Bottone toggleRisultato non trovato.");
            }
        }

        function handleSearch() {
            const searchInput = document.getElementById('searchInput');
            const tableBody = document.getElementById('methodTableBody');
            const rows = tableBody.getElementsByTagName('tr');
            const searchTerm = searchInput.value.toLowerCase();

            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const methodCell = row.cells[0]; // Colonna "Metodo"
                const descriptionCell = row.cells[1]; // Colonna "Descrizione"
                let match = false;

                if (methodCell && descriptionCell) {
                    const methodText = methodCell.textContent || methodCell.innerText;
                    const descriptionText = descriptionCell.textContent || descriptionCell.innerText;

                    if (methodText.toLowerCase().includes(searchTerm) || descriptionText.toLowerCase().includes(searchTerm)) {
                        match = true;
                    }
                }
                row.style.display = match ? '' : 'none';
            }
        }
    </script>

</head>

<body>

    <div class="container">
        <h1 class="my-4">Lavorare con il DOM</h1>
        <nav class="navbar navbar-expand-lg navbar-light bg-light px-3">
            <a class="navbar-brand" href="#">JavaScript</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Selettori
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="#">Selettori</a>
                        <a class="dropdown-item" href="index.html">Array</a>
                        </div>
                    </li>
                </ul>
                <form class="d-flex" role="search">
                    <label for="searchInput" class="visually-hidden">Cerca</label>
                    <input id="searchInput" class="form-control me-2" type="search" placeholder="Cerca" aria-label="Cerca">
                    <button class="btn btn-outline-success visually-hidden" type="submit">Cerca</button>
                </form>
            </div>
        </nav>

        <table class="table table-dark table-hover table-striped">
            <thead>
                <tr>
                <th>Metodo</th>
                <th>Descrizione</th>
                <th>Azioni</th>
                </tr>
            </thead>
            <tbody id="methodTableBody">

                <tr>
                <td>getElementById</td>
                <td>Seleziona <strong>un solo elemento HTML</strong> che ha l'attributo id corrispondente.</td>
                <td><button id="btnEs1" type="button" class="btn btn-primary" data-bs-toggle="modal"
                    data-bs-target="#exampleModal"> demo </button></td>
                </tr>

                <tr>
                <td>getElementsByClassName</td>
                <td>Seleziona tutti gli elementi che hanno una certa classe CSS. <strong>Restituisce una HTMLCollection</strong>, simile a un array.</td>
                <td><button id="btnEs2" type="button" class="btn btn-primary" data-bs-toggle="modal"
                    data-bs-target="#exampleModal"> demo </button></td>
                </tr>

                <tr>
                <td>querySelector</td>
                <td><strong>Seleziona il primo elemento</strong> che corrisponde a un selettore CSS.</td>
                <td><button id="btnEs3" type="button" class="btn btn-primary" data-bs-toggle="modal"
                    data-bs-target="#exampleModal"> demo </button></td>
                </tr>

                <tr>
                <td>querySelectorAll</td>
                <td>Seleziona <strong>tutti gli elementi</strong> che corrispondono a un selettore CSS, <strong>restituendo una NodeList</strong> (puÃ² essere usata con forEach).</td>
                <td><button id="btnEs4" type="button" class="btn btn-primary" data-bs-toggle="modal"
                    data-bs-target="#exampleModal"> demo </button></td>
                </tr>

                <tr>
                <td>forEach</td>
                <td>forEach Ã¨ un <strong>metodo degli array</strong> che permette di <strong>eseguire una funzione su ogni elemento dell'array</strong>, in ordine.</td>
                <td><button id="btnEs5" type="button" class="btn btn-primary" data-bs-toggle="modal"
                    data-bs-target="#exampleModal"> demo </button></td>
                </tr>

            </tbody>
        </table>

        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModal"
        aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 id="titoloEs" class="modal-title" id="modalTitle"></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">

                        <pre><code id="codice" class="language-javascript"></code></pre>

                    </div>

                    <div class="modal-footer">
                        <button id="toggleRisultato" type="button" class="btn btn-primary">Mostra Esito</button>
                    </div>

                    <div class="modal-body" id="demoModalBodyContent">
                        <!-- L'output della funzione verrÃ  inserito qui da JavaScript -->
                        <p id="risultato1"></p>
                        <h1 id="titolo1"></h1>
                        <p id="titolo2"><span class="titolo2"></span></p>
                        <h2 id="calcolo"></h2>
                        <p id="metodi"></p>
                        <p id="listaImg">
                            <span class="img-container"></span>
                            <span class="img-container"></span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        const opzEs = [
            null, // Indice 0 non usato, partiamo da 1
            {
                title: "getElementById",
                codeString: `
function showTesto(containerId, tit) {
    document.getElementById(containerId).innerHTML = tit;
}

showTesto("titolo1","Testo dinamico")`,
                containerRisultato: "titolo1"
            },



            {
                title: "getElementsByClassName",
                codeString: `
function showOra() {
    const now = new Date();
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const seconds = String(now.getSeconds()).padStart(2, '0');
    return \`\${hours}.\${minutes}.\${seconds}\`;
}

function showSaluto(containerClassName, tit) {
    document.getElementsByClassName(containerClassName)[0].innerHTML = tit + \` Sono le \${showOra()}\`;
}

showSaluto("titolo2","Ciao Mondo!")`,
                containerRisultato: "titolo2"
            },



            {
                title: "querySelector",
                codeString: `
function showSomma(selector, a, b) {
    document.querySelector(selector).innerHTML = \`\${a} + \${b} = \${a + b}\`;
}

showSomma("#calcolo",15,27)`,
                containerRisultato: "calcolo"
            },



            {
                title: "querySelectorAll",
                codeString: `
function showLista(selector, items) {
    let listHtml = '<ol class="function-list">';
    for (let i = 0; i < items.length; i++) {
        listHtml += \`<li>\${items[i]}</li>\`;
    }
    listHtml += '</ol>';
    document.querySelectorAll(selector)[0].innerHTML = listHtml;
}

showLista("#metodi", ["getElementById", "getElementsByClassName", "querySelector", "querySelectorAll"]);`,
                containerRisultato: "metodi"
            },


            
            {
                title: "forEach",
                codeString: `
function showListaImg(containerId, images) {
    if(!containerId){
        console.error("Container ID non specificato.");
        return;
    }
    if (!images || !Array.isArray(images)) {
        console.error("L'array di immagini non Ã¨ valido.");
        return;
    }
    const container = document.getElementById(containerId);
    if(!container){
        console.warn(\`Elemento con id "\${containerId}" non trovato.\`);
        return;
    }
    const basePath = "img/240x320/";
    const contenitori = container.querySelectorAll(".img-container");
    contenitori.forEach((div, index) => {
        div.innerHTML = ''; // Pulisci il contenuto precedente
        const img = document.createElement("img");
        with(img){
            src = basePath + images[index];
            alt = \`Immagine \${index + 1}\`;
            classList.add("mb-2");
        }
        div.appendChild(img);
    });
}

showListaImg("listaImg", ["cover001.jpg", "cover002.jpg"]);`,
                containerRisultato: "listaImg"
            }
        ];

        document.addEventListener('DOMContentLoaded', function() {
            const numEsempiValidi = opzEs.filter(Boolean).length;
            initHndlBtn(numEsempiValidi);

            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', handleSearch);
            }

            // Impedisci al form di ricerca di fare il submit tradizionale
            const searchForm = document.querySelector('form.d-flex[role="search"]');
            if (searchForm) {
                searchForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                });
            }
        });
    </script>

</body>

</html>